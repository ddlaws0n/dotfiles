# Skip for non-interactive shells
[[ $- != *i* ]] && return

# Ensure ZDOTDIR
export ZDOTDIR="${ZDOTDIR:-$HOME/.config/zsh}"

# fpath setup
typeset -U fpath
fpath=("$HOME/.local/share/zsh/site-functions" "${HOMEBREW_PREFIX}/share/zsh/site-functions" $fpath)
fpath=(${(u)fpath})

# Source modular files
for file in exports plugins completions aliases functions; do
  [[ -r "$ZDOTDIR/${file}.zsh" ]] && source "$ZDOTDIR/${file}.zsh"
done

# Interactive tool activations
if command -v mise &>/dev/null; then
  eval "$(mise activate zsh)"
fi

# FZF (assume Homebrew install)
if [[ -f "${HOMEBREW_PREFIX}/opt/fzf/shell/key-bindings.zsh" ]]; then
  source "${HOMEBREW_PREFIX}/opt/fzf/shell/key-bindings.zsh"
  source "${HOMEBREW_PREFIX}/opt/fzf/shell/completion.zsh"
fi
export FZF_DEFAULT_OPTS="--color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 --color=fg:#cdd6f4,header:#f38ba8,info:#cba6ac,pointer:#f5e0dc --color=marker:#f5e0dc,fg+:#cdd6f4,prompt:#cba6ac,hl+:#f38ba8"

# 1Password CLI
[[ -f ~/.config/op/plugins.sh ]] && source ~/.config/op/plugins.sh

# Ghostty integration
[[ -n "${GHOSTTY_RESOURCES_DIR}" ]] && source "${GHOSTTY_RESOURCES_DIR}/shell-integration/zsh/ghostty-integration"

# Secrets (Chezmoi-templated)
[[ -r "$ZDOTDIR/env.zsh" ]] && source "$ZDOTDIR/env.zsh"

# Starship prompt (last)
if command -v starship &>/dev/null; then
  eval "$(starship init zsh)"
fi
