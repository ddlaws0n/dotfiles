## MacOS Path Helper, constructs PATH based on /etc/paths & /etc/paths.d/*
if command -v path_helper &> /dev/null; then
  eval "$(/usr/libexec/path_helper -s)"
fi

{{- /* Include path helpers by defining functions inline */ -}}
{{- define "homebrewSetup" -}}
## Homebrew
if [[ -d "/opt/homebrew/bin" ]]; then
  export HOMEBREW_PREFIX="/opt/homebrew"
elif [[ -d "/usr/local/bin" ]]; then
  export HOMEBREW_PREFIX="/usr/local"
fi

if [[ -n "$HOMEBREW_PREFIX" ]]; then
  export PATH="$HOMEBREW_PREFIX/bin:$HOMEBREW_PREFIX/sbin:$PATH"
fi
{{- end -}}

{{- define "xdgPaths" -}}
## XDG Base Directory Specification
export XDG_CONFIG_HOME="{{ .chezmoi.homeDir }}/.config"
export XDG_CACHE_HOME="{{ .chezmoi.homeDir }}/.cache"
export XDG_DATA_HOME="{{ .chezmoi.homeDir }}/.local/share"
export XDG_STATE_HOME="{{ .chezmoi.homeDir }}/.local/state"
{{- end -}}

{{- define "commonPaths" -}}
## Scripts directory
export PATH="$HOME/.scripts:$PATH"
export PATH="$HOME/.local/bin:$PATH"
{{- end -}}

{{- define "editorPrefs" -}}
## Editor preferences
export EDITOR="nano"
export VISUAL="code"
{{- end -}}

{{ template "xdgPaths" . }}

## Zsh configuration directory
export ZDOTDIR="$XDG_CONFIG_HOME/zsh"

# Note: PATH optimization and Homebrew setup is now handled by 
# path-optimization.zsh for better performance and deduplication

## Language environment managers
# Note: bun, go, node, pnpm, uv are managed by mise activate
# Only export variables for tools that need them but aren't PATH-managed by mise

# Bun - mise manages the PATH, but some tools expect BUN_INSTALL
if command -v mise &> /dev/null && mise list bun &> /dev/null; then
  export BUN_INSTALL="$(mise where bun 2>/dev/null || echo "$HOME/.bun")"
fi

# Golang - mise manages the PATH, but some tools expect GOPATH  
if command -v mise &> /dev/null && mise list go &> /dev/null; then
  export GOPATH="$HOME/go"  # Standard location for Go workspace
fi

# Note: Non-mise tools (Windsurf, local bins) are managed by path-optimization.zsh

## Custom paths and environment variables
{{ if .work_computer }}
# Wiz credentials
export WIZ_DOTENV_PATH="$XDG_CONFIG_HOME/wiz/.env"
{{ end }}


{{ if .use_secrets }}
# API Keys
export OPENROUTER_API_KEY="{{- if .secrets }}{{ onepasswordRead .secrets.openrouter_api_key "my" }}{{- else }}{{ onepasswordRead .my.openrouter_api_key "my" }}{{- end }}"
export FIRECRAWL_API_KEY="{{- if .secrets }}{{ onepasswordRead .secrets.firecrawl_api_key "my" }}{{- else }}{{ onepasswordRead .my.firecrawl_api_key "my" }}{{- end }}"
{{ end }}

{{ template "editorPrefs" . }}

# Pager
export PAGER="less"

### Locale settings
export LANG="en_US.UTF-8"

## Tool activations

# Activate mise for version management (primary activation point)
if command -v mise &> /dev/null; then
    eval "$(mise activate zsh)"
fi

# FZF key bindings and fuzzy completion
if [ -f ~/.fzf.zsh ]; then
    source ~/.fzf.zsh
elif [ -f "$HOMEBREW_PREFIX/opt/fzf/shell/key-bindings.zsh" ]; then
    source "$HOMEBREW_PREFIX/opt/fzf/shell/key-bindings.zsh"
    source "$HOMEBREW_PREFIX/opt/fzf/shell/completion.zsh"
fi
