## MacOS Path Helper, constructs PATH based on /etc/paths & /etc/paths.d/*
if command -v path_helper &> /dev/null; then
  eval "$(/usr/libexec/path_helper -s)"
fi

## XDG Base Directory Specification
export XDG_CONFIG_HOME="{{ .chezmoi.homeDir }}/.config"
export XDG_CACHE_HOME="{{ .chezmoi.homeDir }}/.cache"
export XDG_DATA_HOME="{{ .chezmoi.homeDir }}/.local/share"
export XDG_STATE_HOME="{{ .chezmoi.homeDir }}/.local/state"

## Zsh configuration directory
export ZDOTDIR="$XDG_CONFIG_HOME/zsh"

## Essential PATH setup (before mise activation)
if [[ -d "/opt/homebrew/bin" ]] && [[ ":$PATH:" != *":/opt/homebrew/bin:"* ]]; then
  export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:$PATH"
  export HOMEBREW_PREFIX="/opt/homebrew"
elif [[ -d "/usr/local/bin" ]] && [[ ":$PATH:" != *":/usr/local/bin:"* ]]; then
  export PATH="/usr/local/bin:/usr/local/sbin:$PATH"
  export HOMEBREW_PREFIX="/usr/local"
fi

# User/local paths: prepend for developer tools to take precedence
for dir in "$HOME/.local/bin" "$HOME/.scripts" "/Users/dlawson/.codeium/windsurf/bin"; do
  if [[ -d "$dir" ]] && [[ ":$PATH:" != *":$dir:"* ]]; then
    export PATH="$dir:$PATH"
  fi
done

## Language environment managers
if command -v mise &> /dev/null && mise list bun &> /dev/null; then
  export BUN_INSTALL="$(mise where bun 2>/dev/null || echo "$HOME/.bun")"
fi

if command -v mise &> /dev/null && mise list go &> /dev/null; then
  export GOPATH="$HOME/go"
fi

## Custom paths and environment variables
{{ if .work_computer }}
export WIZ_DOTENV_PATH="$XDG_CONFIG_HOME/wiz/.env"
{{ end }}

{{ if and .use_secrets (not .is_ci_workflow) }}
export OPENROUTER_API_KEY="{{ if .secrets }}{{ onepasswordRead .secrets.openrouter_api_key .personal_1p_account }}{{ end }}"
export FIRECRAWL_API_KEY="{{ if .secrets }}{{ onepasswordRead .secrets.firecrawl_api_key .personal_1p_account }}{{ end }}"
{{ end }}

## Editor preferences
export EDITOR="nano"
export VISUAL="code -w"
export PAGER="less"

## Locale settings
export LANG="en_US.UTF-8"

## ZSH Completions Setup
fpath=(
  $HOME/.local/share/zsh/site-functions
  $HOMEBREW_PREFIX/share/zsh/site-functions
  $fpath
)

## Tool activations
if command -v mise &> /dev/null; then
  eval "$(mise activate zsh)"
fi

if [ -f ~/.fzf.zsh ]; then
  source ~/.fzf.zsh
elif [ -f "$HOMEBREW_PREFIX/opt/fzf/shell/key-bindings.zsh" ]; then
  source "$HOMEBREW_PREFIX/opt/fzf/shell/key-bindings.zsh"
  source "$HOMEBREW_PREFIX/opt/fzf/shell/completion.zsh"
fi

export FZF_DEFAULT_OPTS="--color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 --color=fg:#cdd6f4,header:#f38ba8,info:#cba6ac,pointer:#f5e0dc --color=marker:#f5e0dc,fg+:#cdd6f4,prompt:#cba6ac,hl+:#f38ba8"
